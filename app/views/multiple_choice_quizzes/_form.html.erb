<%= form_with(model: [@topic, @multiple_choice_quiz], local: true, class: "form w-100") do |form| %>
  <div class="mb-3">
    <%= form.label :name, class: "form-label" %>
    <%= form.text_field :name, class: "form-control" %>
  </div>

  <div class="d-flex justify-content-between align-items-center">
    <h3>Questions</h3>
    <button type="button" id="add-question" class="btn btn-link p-0" style="font-size: 2.5em; color: hotpink;">
      <i class="bi bi-plus"></i>
    </button>
  </div>
  <div id="questions">
    <% question_index = 0 %>
    <%= form.fields_for :multiple_choice_questions do |question_form| %>
      <div class="nested-fields d-flex align-items-start">
        <div class="question-number me-2" style="font-size: 1.5em; color: hotpink;">
          <%= question_index + 1 %>.
        </div>
        <div class="w-100">
          <div class="mb-3">
            <%= question_form.label :text, "Question", class: "form-label" %>
            <%= question_form.text_field :text, class: "form-control" %>
          </div>
          <div class="mb-3">
            <%= question_form.label :options, "Options (comma-separated)", class: "form-label" %>
            <%= question_form.text_area :options, class: "form-control" %>
          </div>
          <div class="mb-3">
            <%= question_form.label :answer, "Correct Answer", class: "form-label" %>
            <%= question_form.text_field :answer, class: "form-control" %>
          </div>
        </div>
        <div class="d-flex align-items-center ms-2" style="font-size: 1.5em; color: hotpink;">
          <button type="button" class="btn btn-link p-0 ms-2 remove-question">
            <i class="bi bi-trash" style="font-size: 1.5em; color: hotpink;"></i>
          </button>
        </div>
      </div>
    <% end %>
  </div>

  <div class="mb-3">
    <%= form.submit class: "btn btn-primary" %>
  </div>
<% end %>

<script>
  $(document).ready(function() {
    $('#add-question').click(function() {
      var newQuestionIndex = $('#questions .nested-fields').length;
      var newQuestionFields = `
        <div class="nested-fields d-flex align-items-start">
          <div class="question-number me-2" style="font-size: 1.5em; color: hotpink;">
            ${newQuestionIndex + 1}.
          </div>
          <div class="w-100">
            <div class="mb-3">
              <label class="form-label" for="multiple_choice_quiz_multiple_choice_questions_attributes_${newQuestionIndex}_text">Question Text</label>
              <input class="form-control" type="text" name="multiple_choice_quiz[multiple_choice_questions_attributes][${newQuestionIndex}][text]" id="multiple_choice_quiz_multiple_choice_questions_attributes_${newQuestionIndex}_text">
            </div>
            <div class="mb-3">
              <label class="form-label" for="multiple_choice_quiz_multiple_choice_questions_attributes_${newQuestionIndex}_options">Options (comma-separated)</label>
              <textarea class="form-control" name="multiple_choice_quiz[multiple_choice_questions_attributes][${newQuestionIndex}][options]" id="multiple_choice_quiz_multiple_choice_questions_attributes_${newQuestionIndex}_options"></textarea>
            </div>
            <div class="mb-3">
              <label class="form-label" for="multiple_choice_quiz_multiple_choice_questions_attributes_${newQuestionIndex}_answer">Correct Answer</label>
              <input class="form-control" type="text" name="multiple_choice_quiz[multiple_choice_questions_attributes][${newQuestionIndex}][answer]" id="multiple_choice_quiz_multiple_choice_questions_attributes_${newQuestionIndex}_answer">
            </div>
          </div>
          <div class="d-flex align-items-center ms-2" style="font-size: 1.5em; color: hotpink;">
            <button type="button" class="btn btn-link p-0 ms-2 remove-question">
              <i class="bi bi-trash" style="font-size: 1.5em; color: hotpink;"></i>
            </button>
          </div>
        </div>
      `;
      $('#questions').append(newQuestionFields);
    });

    $(document).on('click', '.remove-question', function() {
      $(this).closest('.nested-fields').remove();
      updateQuestionNumbers();
    });

    function updateQuestionNumbers() {
      $('#questions .nested-fields').each(function(index) {
        $(this).find('.question-number').text((index + 1) + '.');
      });
    }
  });
</script>
